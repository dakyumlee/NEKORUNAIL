<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NEKORUNAIL</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="hero">
    <h1>NEKORUNAIL</h1>
    <p>ë¶€ì‚° ë¶€ì‚°ì§„êµ¬ ê°€ì•¼ëŒ€ë¡œ750ë²ˆê¸¸ 4, 3ì¸µ</p>
    <nav>
      <ul>
        <li><a href="index.html">í™ˆ</a></li>
        <li><a href="gallery.html">ê°¤ëŸ¬ë¦¬</a></li>
        <li><a href="booking.html">ì˜ˆì•½</a></li>
        <li><a href="review.html">ë¦¬ë·°</a></li>
        <li><a href="come.html">ì˜¤ì‹œëŠ” ê¸¸</a></li>
      </ul>
    </nav>
  </header>

  <section class="intro-section">
    <div class="intro-content">
      <h2><a href="admin.html">âœ¨NEKORUNAILâœ¨</a></h2>
      <h3>ë„¤ì¼ ë””ìì¸</h3>
    </div>
  </section>

  <section id="gallery">
    <div id="gallery-slider" class="gallery-slider">
      <div class="loading-slider">
        <div class="loading-spinner"></div>
        <p>ë””ìì¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
  </section>

  <section id="customer-reviews" class="reviews-section">
    <h2>ê³ ê° í›„ê¸°</h2>
    <p class="section-subtitle">ì‹¤ì œ ê³ ê°ë‹˜ë“¤ì´ ë‚¨ê²¨ì£¼ì‹  ì†Œì¤‘í•œ í›„ê¸°ì…ë‹ˆë‹¤</p>
    <div id="reviews-container" class="reviews-preview-grid">
      <div class="review-loading">
        <div class="loading-spinner"></div>
        <p>í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
    <div class="reviews-actions">
      <a href="review.html" class="view-more-btn">ëª¨ë“  í›„ê¸° ë³´ê¸°</a>
    </div>
  </section>

  <footer>
    <p>NEKORUNAIL âœ Instagram @nekorunail âœ 2025</p>
  </footer>

  <script type="module">
    console.log('ğŸ”¥ Firebase ì—°ê²° ì‹œì‘...');

    let db = null;
    let connectionRetryCount = 0;
    const MAX_RETRIES = 3;

    async function initializeFirebase() {
      try {
        const { initializeApp } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js");
        const { getFirestore, connectFirestoreEmulator, collection, getDocs, query, orderBy, limit } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");

        const firebaseConfig = {
          apiKey: "AIzaSyBGvgFrFl1DWpkgqbwRo-TUwJa6quvohmA",
          authDomain: "nekorunail.firebaseapp.com",
          projectId: "nekorunail",
          storageBucket: "nekorunail.appspot.com",
          messagingSenderId: "571846382457",
          appId: "1:571846382457:web:6c0f66ca63163473fd15a8"
        };

        const app = initializeApp(firebaseConfig);
        
        try {
          db = getFirestore(app);
          console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ');
          return { collection, getDocs, query, orderBy, limit };
        } catch (firestoreError) {
          console.error('Firestore ì´ˆê¸°í™” ì‹¤íŒ¨:', firestoreError);
          throw firestoreError;
        }

      } catch (error) {
        console.error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        connectionRetryCount++;
        
        if (connectionRetryCount < MAX_RETRIES) {
          console.log(`ì¬ì‹œë„ ì¤‘... (${connectionRetryCount}/${MAX_RETRIES})`);
          await new Promise(resolve => setTimeout(resolve, 2000));
          return initializeFirebase();
        }
        
        throw error;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await loadContent();
      } catch (error) {
        console.error('ì»¨í…ì¸  ë¡œë“œ ì‹¤íŒ¨:', error);
        showOfflineContent();
      }
    });

    async function loadContent() {
      try {
        const firebaseModules = await initializeFirebase();
        await Promise.all([
          loadGallerySlider(firebaseModules),
          loadReviewsPreview(firebaseModules)
        ]);
      } catch (error) {
        console.error('Firebase ì»¨í…ì¸  ë¡œë“œ ì‹¤íŒ¨:', error);
        showOfflineContent();
      }
    }

    async function loadGallerySlider(firebaseModules) {
      const slider = document.getElementById('gallery-slider');
      
      try {
        if (!db || !firebaseModules) {
          throw new Error('Firebase not initialized');
        }

        const { collection, getDocs, query, orderBy, limit } = firebaseModules;
        const q = query(collection(db, "gallery"), orderBy("createdAt", "desc"), limit(6));
        const snapshot = await getDocs(q);
        
        slider.innerHTML = '';
        
        if (snapshot.empty) {
          slider.innerHTML = `
            <div class="no-gallery">
              <p>ê°¤ëŸ¬ë¦¬ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
            </div>
          `;
          return;
        }
        
        snapshot.forEach(doc => {
          const data = doc.data();
          const card = document.createElement('div');
          card.className = 'gallery-card';
          
          card.innerHTML = `
            <img src="${data.imageUrl}" alt="${data.caption || 'nail art'}" loading="lazy">
            <div class="info">
              <h4>${data.caption || 'ë„¤ì¼ ë””ìì¸'}</h4>
            </div>
          `;
          
          card.addEventListener('click', () => {
            openModal(data.imageUrl, data.caption || 'ë„¤ì¼ ë””ìì¸');
          });
          
          slider.appendChild(card);
        });
        
        console.log('âœ… ê°¤ëŸ¬ë¦¬ ë¡œë“œ ì„±ê³µ');
        
      } catch (error) {
        console.error('ê°¤ëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
        slider.innerHTML = `
          <div class="error-gallery">
            <p>ê°¤ëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <button onclick="window.location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: hotpink; color: white; border: none; border-radius: 5px; cursor: pointer;">ìƒˆë¡œê³ ì¹¨</button>
          </div>
        `;
      }
    }

    async function loadReviewsPreview(firebaseModules) {
      const container = document.getElementById('reviews-container');
      
      try {
        if (!db || !firebaseModules) {
          throw new Error('Firebase not initialized');
        }

        const { collection, getDocs, query, orderBy, limit } = firebaseModules;
        const q = query(collection(db, "reviews"), orderBy("createdAt", "desc"), limit(3));
        const snapshot = await getDocs(q);
        
        container.innerHTML = '';
        
        if (snapshot.empty) {
          container.innerHTML = `
            <div class="no-reviews">
              <p>ì•„ì§ ë“±ë¡ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              <p>ì²« ë²ˆì§¸ í›„ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”! âœ¨</p>
            </div>
          `;
          return;
        }
        
        snapshot.forEach(doc => {
          const data = doc.data();
          const reviewCard = document.createElement('div');
          reviewCard.className = 'review-preview';
          
          const createdAt = data.createdAt?.toDate() || new Date();
          const dateString = createdAt.toLocaleDateString('ko-KR');
          const stars = 'â­'.repeat(data.rating || 5);
          
          reviewCard.innerHTML = `
            <div class="stars">${stars}</div>
            <p class="review-text">"${data.content}"</p>
            <cite class="review-author">- ${data.name} (${dateString})</cite>
          `;
          
          container.appendChild(reviewCard);
        });
        
        console.log('âœ… í›„ê¸° ë¡œë“œ ì„±ê³µ');
        
      } catch (error) {
        console.error('í›„ê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
        container.innerHTML = `
          <div class="error-message">
            <p>í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <button onclick="window.location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: hotpink; color: white; border: none; border-radius: 5px; cursor: pointer;">ìƒˆë¡œê³ ì¹¨</button>
          </div>
        `;
      }
    }

    function showOfflineContent() {
      console.log('ğŸ“± ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜');
      
      const slider = document.getElementById('gallery-slider');
      slider.innerHTML = `
        <div class="offline-content">
          <h3>ğŸŒ ì—°ê²° ë¬¸ì œ</h3>
          <p>ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</p>
          <button onclick="window.location.reload()" style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: hotpink; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600;">ë‹¤ì‹œ ì‹œë„</button>
        </div>
      `;
      
      const reviewsContainer = document.getElementById('reviews-container');
      reviewsContainer.innerHTML = `
        <div class="offline-content">
          <p>ë„¤íŠ¸ì›Œí¬ ì—°ê²° í›„ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”</p>
        </div>
      `;
    }

    function openModal(imageUrl, caption) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); display: flex; align-items: center;
        justify-content: center; z-index: 10000; cursor: pointer;
      `;
      
      modal.innerHTML = `
        <div style="position: relative; max-width: 90vw; max-height: 90vh; background: white; border-radius: 10px; overflow: hidden;">
          <span style="position: absolute; top: 10px; right: 15px; font-size: 2rem; color: white; cursor: pointer; background: rgba(0,0,0,0.5); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">&times;</span>
          <img src="${imageUrl}" style="max-width: 100%; max-height: 80vh; display: block;" />
          <div style="padding: 1rem; text-align: center; font-weight: 600; color: #333;">${caption}</div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      modal.querySelector('span').onclick = () => modal.remove();
      modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') modal.remove(); });
    }

    const style = document.createElement('style');
    style.textContent = `
      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid hotpink;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .intro-section {
        padding: 2rem 2rem 0;
        text-align: center;
      }
      
      .intro-content h2 {
        font-size: 2.5rem;
        color: #333;
        margin-bottom: 0.5rem;
      }
      
      .intro-content h3 {
        font-size: 1.3rem;
        color: #666;
        margin-bottom: 1rem;
        font-weight: 400;
      }
      
      .loading-slider, .no-gallery, .error-gallery, .offline-content {
        text-align: center;
        padding: 3rem 2rem;
        color: #666;
      }
      
      .offline-content h3 {
        color: #333;
        margin-bottom: 1rem;
      }
      
      .review-preview {
        background: white;
        padding: 1.5rem;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        text-align: center;
      }
      
      .review-preview .stars {
        margin-bottom: 1rem;
        font-size: 1.2rem;
      }
      
      .review-text {
        font-style: italic;
        color: #333;
        margin-bottom: 1rem;
        line-height: 1.5;
      }
      
      .review-author {
        color: #666;
        font-size: 0.9rem;
      }
      
      .no-reviews, .error-message, .offline-content {
        text-align: center;
        padding: 2rem;
        color: #666;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        grid-column: 1 / -1;
      }
      
      @media (max-width: 768px) {
        .intro-content h2 {
          font-size: 2rem;
        }
        
        .intro-content h3 {
          font-size: 1.1rem;
        }
      }
    `;
    document.head.appendChild(style);

    console.log('ğŸ“± í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
  </script>
</body>
</html>